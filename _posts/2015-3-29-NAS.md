---
layout: post
title: おうちNAS2015構築
---
 * ハードウェア準備編
   - ベアボーン:SH97R6（秋葉）
     * 最大メモリが32GBで比較的省電力なベアボーンを探したらこのぐらいしかなかった。SH87R6でよかったのだが、売ってないのでやむなくこれに。
   - CPU: Core i5-4690S（秋葉）
     * ZFS+仮想化を考えるとHT抜き4コアは必須。この時点でi5かi7だが、HTの悪さを防ごうとすると実質i5一択（i7でHTオフにすることはできるが、それi7にする意味ないよね）。
     * TDP35Wで省電力を攻めるか、TDP65Wである程度性能を求めるかで最後まで悩んだが、ベアボーンがSH97R6で熱設計に余裕があること、アイドル時の電力はそれほど差がないこと、ZFSでどの程度性能が要求されるか読めなかったことなどからi5-4690Sにした。
   - メモリ: Crucial 8GB*2（秋葉）
     * 最終的に32GBにすることは確定なのだが、一気に買えるほど大人ではないのと問題が発生した時の切り分け用にある程度minimumで16GB。
   - mSATA SSD:Crucial 256GB（秋葉）
     * FreeNASに確定しているならUSBメモリでよかったのだが、仮想化のあたりもどうなるかわからない状況でFreeNAS一択とは言えないため、SSDに。
   - HDD: Western Degital 6GB(WD Green)*1（秋葉）
     * Redじゃないのかよ。はい。
     * 今回急いで構築する目的が比較的バックアップ寄りであることと、近場でREDの6TBが売っていないことからこうなった。
     * もう少し6TB HDDが安ければ大人買いしてZFS組んでQNAPから交代するところだったが、安くないのでもうしばらく待ち。
   - ポータブルDVD（近場の量販店）
     * これも少し悩んだ。OSインストール用途だけならUSB2.0のDVD-ROMでいいのだが、せっかく買うならBDXL対応とかよくない？とか。けど最終的には安物で済ませた。なによりお財布がきつい。
   - HDDケース: 裸族の集合住宅5Bay SATA6G（近場の量販店）
     * RAIDなしで安く、かつ、6TBのHDD認識が保証できているもの。某量販店Yで空箱はあるけど実物はありませんとかやられて、別の量販店に見に行くことになったのは秘密。
     * 実は当初の予定ではこいつをQNAPにつないで直接バックアップとるつもりだったのだが、QNAP側が正しく要領を認識できず、強行してもFormatできずという状況でこの計画はなくなった。
     * というより、これができないからNASの組み立てを急いでQNAP->NASのネットワーク経由のバックアップをとることになった。
   - HDMIケーブル、HDMI-RGB変換コネクタなどなど（超近場の量販店）
     * 完全に予定外の出費。HDMIかよ。HDMIのケーブルないのかよ。
   - 使いまわし
     * 昔買ったPLEXTOR 512GBのSSD。ずっと使ってなかったけど、ZFSのZIL用に。

* ソフトウェア準備編（ハードウェア動作確認などの暫定）
  - Ubuntu Server 14.04LTS

* 動作確認
  - MemTest86
  - HDDの不良ブロックの確認
    * 以下だとbadblocks: Value too large for defined data type invalid end block (5860520960): must be 32-bit valueと言われる  
# badblocks -sv -c 256 -w /dev/sdb1
    * 以下で回避。  
# badblocks -sv -c 256 -b 4096 -w /dev/sdb1
* 当面の計画
  - 旧NAS(QNAP)のデータ救済（まだ死んでないけど）は新NASの6TBのHDDに行う（badblocksでエラーが出ない前提）
  - RAIDケースは買ってきたので6TB HDDが安くなったタイミングで大人買いする。ただしQNAPが死んだ場合はその限りではない
* 6TBのHDDが現在3万ちょっとするので、これを5本はさすがに出費としてきつい（すでに今回のマシン諸々で15万以上飛ばしているし）。かといって値ごろな3TB HDDを5台にしても15*60%=9TBで、現状の6TBから新味がない。 そういったあたりを踏まえた様子見含みの計画。

  
